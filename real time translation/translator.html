<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Speech Translator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #00c6ff, #0072ff);
            color: white;
        }
        h1 {
            margin-top: 20px;
            font-size: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        .container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 20px;
        }
        .video-section {
            flex: 1;
            text-align: center;
        }
        .video-section video {
            border-radius: 20px;
            margin: 20px 0;
            width: 100%;
            max-width: 500px;
            display: block;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .translation-section {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        #language-selector {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        select {
            padding: 10px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            outline: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
            margin: 10px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #start-btn {
            background-color: #00c851;
            color: white;
        }
        #start-btn:hover {
            background-color: #007e33;
            transform: scale(1.05);
        }
        #stop-btn {
            background-color: #ff4444;
            color: white;
        }
        #stop-btn:hover {
            background-color: #cc0000;
            transform: scale(1.05);
        }
        #translation h2 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Real-time Speech Translator</h1>

    <div class="container">
        <!-- Video Section -->
        <div class="video-section">
            <video id="camera" autoplay muted></video>
        </div>

        <!-- Translation Section -->
        <div class="translation-section">
            <h2>Translation</h2>
            <p id="original-text">Original Speech: </p>
            <p id="translated-text">Translated Text: </p>
        </div>
    </div>

    <!-- Language Selector -->
    <div id="language-selector">
        <label for="language-dropdown">üåç Select Target Language:</label>
        <select id="language-dropdown">
            <option value="hi">Hindi</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="kn">Kannada</option>
            <option value="zh-CN">Chinese (Simplified)</option>
            <option value="ar">Arabic</option>
            <option value="bn">Bengali</option>
            <option value="ru">Russian</option>
            <option value="pt">Portuguese</option>
            <option value="ja">Japanese</option>
            <option value="de">German</option>
            <option value="ta">Tamil</option>
            <option value="te">Telugu</option>
        </select>
    </div>

    <!-- Controls -->
    <div>
        <button id="start-btn">‚ñ∂Ô∏è Start Listening</button>
        <button id="stop-btn" disabled>‚èπÔ∏è Stop Listening</button>
    </div>

    <script>
        const camera = document.getElementById('camera');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const languageDropdown = document.getElementById('language-dropdown');
        const originalText = document.getElementById('original-text');
        const translatedText = document.getElementById('translated-text');

        let recognition;
        let isListening = false;

        // Get mode from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get('mode'); // 'audio' or 'video'

        async function startCamera() {
            try {
                const constraints = mode === 'video' ? { video: true, audio: true } : { audio: true };
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                camera.srcObject = stream;
                if (mode === 'audio') {
                    camera.style.display = 'none'; // Hide video element for audio-only mode
                }
            } catch (error) {
                alert('Unable to access the camera or microphone.');
            }
        }

        function startListening() {
            if (!recognition) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US';
                recognition.continuous = true;

                recognition.onresult = async (event) => {
                    const speech = event.results[event.results.length - 1][0].transcript.trim();
                    originalText.textContent = `Original Speech: ${speech}`;
                    
                    // Translate the speech to the target language
                    const translated = await translateText(speech, languageDropdown.value);
                    translatedText.textContent = `Translated Text: ${translated}`;

                    // Speak the translated text in the target language
                    speak(translated, languageDropdown.value);
                };
            }
            recognition.start();
            isListening = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
        }

        function stopListening() {
            if (recognition && isListening) {
                recognition.stop();
                isListening = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        async function translateText(text, targetLang) {
            const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
            const response = await fetch(url);
            const data = await response.json();
            return data[0][0][0];
        }

        function speak(text, lang) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;

            // Ensure the correct voice for the language
            const voices = window.speechSynthesis.getVoices();
            const matchedVoice = voices.find(voice => voice.lang.startsWith(lang));
            if (matchedVoice) {
                utterance.voice = matchedVoice;
            } else {
                console.warn(`No voice found for language: ${lang}`);
            }

            window.speechSynthesis.speak(utterance);
        }

        // Start camera based on mode
        startCamera();

        startBtn.addEventListener('click', startListening);
        stopBtn.addEventListener('click', stopListening);
    </script>
</body>
</html>
